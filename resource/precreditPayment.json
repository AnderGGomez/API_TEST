{
    "openapi": "3.0.0",
    "paths": {
        "/api/payment/v1/health": {
            "get": {
                "operationId": "HealthController_check",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "The Health Check is successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "ok"
                                        },
                                        "info": {
                                            "type": "object",
                                            "example": {
                                                "database": {
                                                    "status": "up"
                                                }
                                            },
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            },
                                            "nullable": true
                                        },
                                        "error": {
                                            "type": "object",
                                            "example": {},
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            },
                                            "nullable": true
                                        },
                                        "details": {
                                            "type": "object",
                                            "example": {
                                                "database": {
                                                    "status": "up"
                                                }
                                            },
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "The Health Check is not successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "error"
                                        },
                                        "info": {
                                            "type": "object",
                                            "example": {
                                                "database": {
                                                    "status": "up"
                                                }
                                            },
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            },
                                            "nullable": true
                                        },
                                        "error": {
                                            "type": "object",
                                            "example": {
                                                "redis": {
                                                    "status": "down",
                                                    "message": "Could not connect"
                                                }
                                            },
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            },
                                            "nullable": true
                                        },
                                        "details": {
                                            "type": "object",
                                            "example": {
                                                "database": {
                                                    "status": "up"
                                                },
                                                "redis": {
                                                    "status": "down",
                                                    "message": "Could not connect"
                                                }
                                            },
                                            "additionalProperties": {
                                                "type": "object",
                                                "required": [
                                                    "status"
                                                ],
                                                "properties": {
                                                    "status": {
                                                        "type": "string"
                                                    }
                                                },
                                                "additionalProperties": true
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Health"
                ]
            }
        },
        "/api/payment/v1/payment-methods": {
            "post": {
                "operationId": "PaymentMethodController_create",
                "parameters": [],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreatePaymentMethodDto"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaymentMethodResponseDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Crear método de pago tokenizado",
                "tags": [
                    "payment-methods"
                ]
            }
        },
        "/api/payment/v1/payment-methods/list": {
            "post": {
                "operationId": "PaymentMethodController_list",
                "parameters": [],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/PaymentMethodQueryDto"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedPaymentMethodsDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Listar métodos de pago (POST con filtros y búsqueda)",
                "tags": [
                    "payment-methods"
                ]
            }
        },
        "/api/payment/v1/payment-methods/{id}/primary": {
            "put": {
                "operationId": "PaymentMethodController_setPrimary",
                "parameters": [
                    {
                        "name": "id",
                        "required": true,
                        "in": "path",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/SetPrimaryDto"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaymentMethodResponseDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Marcar un método de pago como principal",
                "tags": [
                    "payment-methods"
                ]
            }
        },
        "/api/payment/v1/payment-methods/{id}": {
            "delete": {
                "operationId": "PaymentMethodController_delete",
                "parameters": [
                    {
                        "name": "id",
                        "required": true,
                        "in": "path",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Eliminado"
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Eliminar método de pago (no principal)",
                "tags": [
                    "payment-methods"
                ]
            }
        },
        "/api/payment/v1/payments": {
            "post": {
                "operationId": "PaymentController_create",
                "parameters": [],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreatePaymentDto"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaymentResponseDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Registrar pago (simulado) con método tokenizado",
                "tags": [
                    "payments"
                ]
            },
            "get": {
                "operationId": "PaymentController_history",
                "parameters": [
                    {
                        "name": "page",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": 1,
                            "type": "number"
                        }
                    },
                    {
                        "name": "limit",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": 20,
                            "type": "number"
                        }
                    },
                    {
                        "name": "status",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "PENDING",
                                "SUCCESS",
                                "FAILED",
                                "TOKENIZED"
                            ]
                        }
                    },
                    {
                        "name": "product_id",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": 123,
                            "type": "number"
                        }
                    },
                    {
                        "name": "plan_id",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": 10,
                            "type": "number"
                        }
                    },
                    {
                        "name": "from_date",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": "2025-11-01",
                            "type": "string"
                        }
                    },
                    {
                        "name": "to_date",
                        "required": false,
                        "in": "query",
                        "schema": {
                            "example": "2025-11-30",
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedPaymentsDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Historial de pagos",
                "tags": [
                    "payments"
                ]
            }
        },
        "/api/payment/v1/payments/register-charge": {
            "post": {
                "operationId": "PaymentController_registerAndCharge",
                "parameters": [],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/RegisterAndChargeDto"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaymentResponseDto"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearer": []
                    }
                ],
                "summary": "Registrar tarjeta y ejecutar pago vía Laravel",
                "tags": [
                    "payments"
                ]
            }
        }
    },
    "info": {
        "title": "Modelo de Documentación de APIs",
        "description": "Esta es una API prototipo configurada con Swagger, diseñada para ser el punto de partida en el desarrollo de nuevas aplicaciones. Contiene configuraciones base y estandarizadas para el manejo de documentación y pruebas.",
        "version": "1.0",
        "contact": {}
    },
    "tags": [],
    "servers": [],
    "components": {
        "securitySchemes": {
            "bearer": {
                "scheme": "bearer",
                "bearerFormat": "JWT",
                "type": "http"
            }
        },
        "schemas": {
            "CreatePaymentMethodDto": {
                "type": "object",
                "properties": {
                    "token": {
                        "type": "string",
                        "example": "tok_9f83jdlsKQW234",
                        "description": "Token seguro devuelto por Laravel/Pasarela (no PAN)"
                    },
                    "last4": {
                        "type": "string",
                        "example": "0416",
                        "description": "Últimos 4 dígitos de la tarjeta"
                    },
                    "franchise": {
                        "type": "string",
                        "enum": [
                            "VISA",
                            "MASTERCARD",
                            "AMEX",
                            "DISCOVER",
                            "DINERS_CLUB",
                            "UNKNOWN"
                        ],
                        "example": "VISA"
                    },
                    "cardholder_name": {
                        "type": "string",
                        "example": "BYRON ANTONIO",
                        "description": "Nombre del titular tal como aparece en la tarjeta"
                    },
                    "phone": {
                        "type": "string",
                        "example": "522435422",
                        "description": "Teléfono del cliente en formato internacional"
                    },
                    "countryCode": {
                        "type": "string",
                        "example": "+502",
                        "description": "Código país display para validar y normalizar el teléfono (ej: +57, +502, +1 809)"
                    },
                    "email": {
                        "type": "string",
                        "example": "byron@gmail.com",
                        "description": "Correo electrónico asociado"
                    },
                    "is_primary": {
                        "type": "boolean",
                        "example": true,
                        "description": "Indica si este método será el principal"
                    },
                    "alias": {
                        "type": "string",
                        "example": "Tarjeta Corporativa",
                        "description": "Alias opcional para mostrar en el listado"
                    }
                },
                "required": [
                    "token",
                    "last4",
                    "franchise",
                    "cardholder_name",
                    "phone",
                    "countryCode",
                    "email"
                ]
            },
            "PaymentMethodResponseDto": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "number"
                    },
                    "last4": {
                        "type": "string",
                        "description": "Últimos 4 dígitos de la tarjeta"
                    },
                    "franchise": {
                        "type": "string",
                        "enum": [
                            "VISA",
                            "MASTERCARD",
                            "AMEX",
                            "DISCOVER",
                            "DINERS_CLUB",
                            "UNKNOWN"
                        ]
                    },
                    "cardholder_name": {
                        "type": "string",
                        "description": "Nombre del titular"
                    },
                    "alias": {
                        "type": "object",
                        "description": "Alias opcional"
                    },
                    "email": {
                        "type": "string",
                        "description": "Correo asociado"
                    },
                    "phone": {
                        "type": "string",
                        "description": "Teléfono asociado"
                    },
                    "is_primary": {
                        "type": "boolean",
                        "description": "Indica si es el método principal"
                    },
                    "user_id": {
                        "type": "object",
                        "description": "ID del usuario (si aplica)"
                    },
                    "company_id": {
                        "type": "object",
                        "description": "ID de la compañía (si aplica)"
                    },
                    "status": {
                        "type": "string",
                        "description": "Estado del método"
                    }
                },
                "required": [
                    "id",
                    "last4",
                    "franchise",
                    "cardholder_name",
                    "alias",
                    "email",
                    "phone",
                    "is_primary",
                    "status"
                ]
            },
            "PaymentMethodQueryDto": {
                "type": "object",
                "properties": {
                    "page": {
                        "type": "number",
                        "example": 1
                    },
                    "limit": {
                        "type": "number",
                        "example": 10
                    },
                    "sort_by": {
                        "type": "string",
                        "enum": [
                            "is_primary",
                            "franchise",
                            "last4",
                            "cardholder_name",
                            "email"
                        ],
                        "example": "is_primary"
                    },
                    "sort_dir": {
                        "type": "string",
                        "example": "asc",
                        "description": "asc | desc"
                    },
                    "franchise": {
                        "type": "string",
                        "enum": [
                            "VISA",
                            "MASTERCARD",
                            "AMEX",
                            "DISCOVER",
                            "DINERS_CLUB",
                            "UNKNOWN"
                        ],
                        "description": "Filtrar por franquicia",
                        "example": "VISA"
                    },
                    "search": {
                        "type": "string",
                        "example": "john",
                        "description": "Búsqueda global: token, last4, titular, alias, email, phone, franquicia (ignora mayúsculas y símbolos básicos)."
                    }
                }
            },
            "PaginatedPaymentMethodsDto": {
                "type": "object",
                "properties": {
                    "data": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/PaymentMethodResponseDto"
                        }
                    },
                    "page": {
                        "type": "number"
                    },
                    "limit": {
                        "type": "number"
                    },
                    "total": {
                        "type": "number"
                    }
                },
                "required": [
                    "data",
                    "page",
                    "limit",
                    "total"
                ]
            },
            "SetPrimaryDto": {
                "type": "object",
                "properties": {
                    "is_primary": {
                        "type": "boolean",
                        "example": true
                    }
                },
                "required": [
                    "is_primary"
                ]
            },
            "CreatePaymentDto": {
                "type": "object",
                "properties": {
                    "payment_method_id": {
                        "type": "number",
                        "example": 10,
                        "description": "ID del método de pago ya registrado"
                    },
                    "amount": {
                        "type": "string",
                        "example": "199.99",
                        "description": "Monto con 2 decimales"
                    },
                    "currency": {
                        "type": "string",
                        "example": "USD"
                    },
                    "reference": {
                        "type": "string",
                        "example": "ORD-4587"
                    },
                    "description": {
                        "type": "string",
                        "example": "Pago activación de producto crédito"
                    }
                },
                "required": [
                    "payment_method_id",
                    "amount"
                ]
            },
            "PaymentResponseDto": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "number"
                    },
                    "payment_method_id": {
                        "type": "number"
                    },
                    "company_id": {
                        "type": "number"
                    },
                    "user_id": {
                        "type": "object"
                    },
                    "amount": {
                        "type": "string"
                    },
                    "currency": {
                        "type": "string"
                    },
                    "reference": {
                        "type": "object"
                    },
                    "description": {
                        "type": "object"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "PENDING",
                            "SUCCESS",
                            "FAILED",
                            "TOKENIZED"
                        ]
                    },
                    "error_code": {
                        "type": "object"
                    },
                    "error_message": {
                        "type": "object"
                    },
                    "decisionCode": {
                        "type": "object"
                    },
                    "reasonCode": {
                        "type": "object"
                    },
                    "authorizationCode": {
                        "type": "object"
                    },
                    "uuid_transactions": {
                        "type": "object"
                    },
                    "requestID": {
                        "type": "object"
                    },
                    "product_id": {
                        "type": "object"
                    },
                    "plan_id": {
                        "type": "object"
                    },
                    "action": {
                        "type": "object"
                    }
                },
                "required": [
                    "id",
                    "payment_method_id",
                    "company_id",
                    "user_id",
                    "amount",
                    "currency",
                    "reference",
                    "description",
                    "status",
                    "error_code",
                    "error_message"
                ]
            },
            "RegisterAndChargeDto": {
                "type": "object",
                "properties": {
                    "token": {
                        "type": "string",
                        "example": "tok_9f83jdlsKQW234"
                    },
                    "last4": {
                        "type": "string",
                        "example": "0416"
                    },
                    "franchise": {
                        "type": "string",
                        "enum": [
                            "VISA",
                            "MASTERCARD",
                            "AMEX",
                            "DISCOVER",
                            "DINERS_CLUB",
                            "UNKNOWN"
                        ],
                        "example": "VISA"
                    },
                    "cardholder_name": {
                        "type": "string",
                        "example": "BYRON ANTONIO"
                    },
                    "phone": {
                        "type": "string",
                        "example": "222435422"
                    },
                    "countryCode": {
                        "type": "string",
                        "example": "+502"
                    },
                    "email": {
                        "type": "string",
                        "example": "byron@gmail.com"
                    },
                    "alias": {
                        "type": "string",
                        "example": "Tarjeta Corporativa"
                    },
                    "is_primary": {
                        "type": "boolean",
                        "example": true
                    },
                    "amount": {
                        "type": "string",
                        "example": "199.99"
                    },
                    "currency": {
                        "type": "string",
                        "example": "USD"
                    },
                    "reference": {
                        "type": "string",
                        "example": "ORD-4587"
                    },
                    "description": {
                        "type": "string",
                        "example": "Pago activación de producto crédito"
                    }
                },
                "required": [
                    "token",
                    "last4",
                    "franchise",
                    "cardholder_name",
                    "phone",
                    "countryCode",
                    "email",
                    "amount"
                ]
            },
            "PaginatedPaymentsDto": {
                "type": "object",
                "properties": {
                    "items": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/PaymentResponseDto"
                        }
                    },
                    "total": {
                        "type": "number"
                    },
                    "page": {
                        "type": "number"
                    },
                    "limit": {
                        "type": "number"
                    }
                },
                "required": [
                    "items",
                    "total",
                    "page",
                    "limit"
                ]
            }
        }
    }
}